#!/usr/bin/env bash
# Helper script to toggle VPN connections via dmenu.

# Pull out list of VPN connection profiles from NetworkManager along
# with current state. Pipe the results into dmenu with insensitive
# case matching enabled.
connection=$(nmcli -t --fields name,type,active c show | grep vpn | sed 's/:vpn:no//g' | sed 's/:vpn:yes/ \(Active\)/g' | sort | dmenu -i "$@")

# If no connection was selected, abort now.
[[ -n $connection ]] || exit

# Connection selected, check if the connection is active, if it is
# then shutdown the connection, if it's not, bring it up.
if [[ $connection == *"(Active)"* ]]; then
  nmcli c down "${connection// \(Active\)/}"
else
  nmcli c up "$connection" --ask
fi
